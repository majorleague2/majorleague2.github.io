<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor Directv GO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
    <script data-cfasync="false" src="//achcdn.com/script/suv4.js" data-adel="lwsu" cdnd="achcdn.com" zid="7692102"></script>
</head>

<body>
    <div id="player"></div>

    <script>
        const token = "eyJhbGciOiJSUzI1NiJ9....";
        const chid = "CH0100000000341";
        const keyId = "de7d7ded48b437d691966acdc8a97262";
        const key = "c1696c67cf7a678932d33340135ea82b";

        const authorizationApiUrl = "https://api.directvgo.com/experiences/v3/playback/token/authorizer";
        const authorizationRequestOptions = {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json',
                'X-Client-Id': 'web',
                'X-Client-Version': '3.17.0',
            },
            body: JSON.stringify({
                contentId: chid,
                delay: 0,
                isLive: true,
                mobileNetwork: true,
            }),
        };

        fetch(authorizationApiUrl, authorizationRequestOptions)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error de HTTP! Estado: ' + response.status);
                }
                return response.json();
            })
            .then(authorizationData => {
                if (authorizationData.manifest && authorizationData.manifest.dash && authorizationData.manifest.dash.primary) {
                    const manifestUrl = authorizationData.manifest.dash.primary;

                    const player = jwplayer("player");
                    player.setup({
                        playlist: [{
                            title: "Título del Video",
                            description: "Descripción del Video",
                            sources: [{
                                default: false,
                                type: "dash",
                                file: manifestUrl,
                                drm: {
                                    clearkey: {
                                        keyId: keyId,
                                        key: key,
                                    },
                                },
                                label: "0",
                                onXhrOpen: function (xhr, url) {
                                    if (!url.includes("manifest.mpd")) {
                                        xhr.setRequestHeader("Hdntl", authorizationData.headers.get('hdntl'));
                                    }
                                },
                            }],
                        }],
                        width: "100%",
                        height: "100%",
                        aspectratio: "16:9",
                        autostart: false,
                        cast: {},
                        sharing: {},
                    });
                } else {
                    console.error("URL principal de Dash no encontrada en la respuesta.");
                }
            })
            .catch(error => console.error('Error al obtener el token de autorización:', error));
    </script>
</body>

</html>
