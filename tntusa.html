<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitmovin Player Example</title>
    <link rel="stylesheet" type="text/css" href="https://bitmovin-a.akamaihd.net/bitmovin-player/stable/7.8/bitmovinplayer-ui.css">
</head>
<body>

<div id="bitmovin-player"></div>

<script type="text/javascript" src="//bitmovin-a.akamaihd.net/bitmovin-player/stable/7.8/bitmovinplayer.js"></script>

<script>
  async function getDashManifestUrl() {
    try {
        const response = await fetch(
            'https://cbd46b77.cdn.cms.movetv.com/playermetadata/sling/v1/api/channels/d74f03db90624c769e0c6d4c9745660d/current/schedule.qvt'
        );
        const data = await response.json();
        if (data.playback_info && data.playback_info.dash_manifest_url) {
            const LA_URL = 'https://p-drmwv.movetv.com/widevine/proxy';
            const playerConfig = {
                playback: {
                    autoplay: false,
                    muted: false,
                },
                key: 'Y2tvaWtjY29lbSEqXyVrZG9lYTJzZT9yb201ZGFzaXMzMGRiMEElXzo=',
                style: {
                    width: '100%',
                    aspectratio: '16:9',
                    controls: true,
                },
                source: {
                    title: 'Reproductor | Rustico TV',
                    description: 'Estamos para Quedarnos',
                    dash: 'https://images261-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&url=' + data.playback_info.dash_manifest_url,
                    drm: {
                        widevine: {
                            LA_URL: LA_URL,
                            prepareMessage: function(message) {
                                return JSON.stringify({
                                    env: 'production',
                                    user_id: 'ca02b1e4-c4a8-11e7-bf6c-0e8187720418',
                                    channel_id: 'd74f03db90624c769e0c6d4c9745660d',
                                    message: Array.from(new Uint8Array(message.message)),
                                });
                            },
                        },
                        playready: {
                            LA_URL: LA_URL,
                        },
                    },
                },
                network: {
                    preprocessHttpRequest: function(type, request) {
                        if (type === bitmovin.player.network.REQUEST_TYPE.DRM_LICENSE_WIDEVINE) {
                            request.method = 'POST';
                            var authorizationHeader = {
                                name: 'Authorization',
                                value: 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjM1Mzg2NjY1LTMzNjQtNjMzNy0zMjY0LTM5MzUzNTY2Mzk2NCJ9.eyJ1c2VyX2d1aWQiOiJjYTAyYjFlNC1jNGE4LTExZTctYmY2Yy0wZTgxODc3MjA0MTgiLCJjaGFubmVsX2d1aWQiOiJkNzRmMDNkYjkwNjI0Yzc2OWUwYzZkNGM5NzQ1NjYwZCIsImR5bmFfaWQiOiIxOCIsInF2dCI6Imh0dHBzOi8vY2JkNDZiNzcuY2RuLmNtcy5tb3ZldHYuY29tL3BsYXllcm1ldGFkYXRhL3NsaW5nL3YxL2FwaS9jaGFubmVscy9kNzRmMDNkYjkwNjI0Yzc2OWUwYzZkNGM5NzQ1NjYwZC9jdXJyZW50L3NjaGVkdWxlLnF2dCJ9.vDanyP4CVFL0M76V36UabQTxSzAdrSsL_n-3o5Kl3XbNx6bne_FM0W2mENAFQKrQyDPtteh5a8WgnmKIR82MrrqHI6QYjsKBbFvqnqgVh7LHhC0jGhV0CHkmcaZ3UsIxrnsz19uq0JSAVOuFSadRD0e__AN3iwLgu-Uv_YbB2Mh-qfR7IrgEoRKz75YXsX9cs85VrWyNtRW93-wskw7SyX97OTSjCQhyOo755B652g4Kcm_YyVk8YDb6h9w3aRaYRDzWdS9SfyQ01-0f4VMpLh3r0vgZp7cpvmsR7-kcXfLr2o4leoIvM8ljQYxBmjdJnM6so46n5FhHYI4LzAyTOQ',
                            };
                            request.headers.push(authorizationHeader);
                            return Promise.resolve(request);
                        }
 
                        if (request.url.includes('.mp4') || request.url.includes('.m4s')) {
                            request.url = 'https://images133-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&url=' + request.url;
                        }
 
                        return request;
                    },
                },
            };
            const player = bitmovin.player('my-player');
            player.setup(playerConfig).then(
                function(value) {
                    console.log('Successfully created bitmovin player instance');
                    const unmuteBtn = document.getElementById('unmute-btn');
                    unmuteBtn.addEventListener('click', function() {
                        player.unmute();
                        player.setVolume(90);
                        unmuteBtn.style.display = 'none';
                    });
                },
                function(error) {
                    console.log('Error while creating bitmovin player instance', error);
                }
            );
        } else {
            throw new Error('bad data.playback_info.dash_manifest_url');
        }
    } catch (error) {
        throw new Error(error);
    }
}
getDashManifestUrl();
</script>

</body>
</html>
